<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>FaithMoods 2.0</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />

<style>
:root {
  --purple:#6C63FF; --glass-bg:rgba(255,255,255,0.2);
  --shadow:0 4px 30px rgba(0,0,0,0.1);
  --blur:blur(12px);
}
body {
  margin:0;font-family:Poppins,sans-serif;
  background:linear-gradient(120deg,#6C63FF,#8E2DE2,#4A00E0);
  background-size:400% 400%; animation:bg 14s ease infinite;
  color:white; display:flex; flex-direction:column; align-items:center;
}
@keyframes bg {0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
#intro {
  position:fixed; inset:0; display:flex; flex-direction:column;
  justify-content:center; align-items:center; font-size:2rem;
  z-index:1000; background:inherit; animation:bg 14s ease infinite;
}
.fadeOut {animation:fade 1.6s forwards;}
@keyframes fade {to{opacity:0;visibility:hidden;}}

button {
  background:var(--purple); padding:.6rem 1rem; border:none;
  border-radius:8px; cursor:pointer; color:white;
  font-size:1rem; margin-top:.7rem;
}
button:hover {opacity:.85}

header {text-align:center; margin-top:4rem;}
.container {
  width:90%; max-width:1100px; margin-top:2rem;
  display:flex; gap:1.5rem; flex-wrap:wrap; justify-content:center;
}
.panel {
  flex:1; min-width:280px; padding:1.5rem; border-radius:1rem;
  background:rgba(255,255,255,.15); backdrop-filter:blur(14px);
}

#emotions li {
  background:rgba(255,255,255,.2);
  margin:.35rem 0; padding:.5rem; border-radius:.5rem;
  cursor:pointer;
}
#emotions li:hover {background:rgba(255,255,255,.35)}

#verseCard {
  min-height:80px; padding:1rem; margin-top:1rem;
  background:rgba(255,255,255,.15); border-left:4px solid var(--purple);
  font-style:italic; border-radius:8px; opacity:0; transition:.4s;
}
#verseCard.visible {opacity:1;}

textarea {
  width:100%; height:120px; margin-top:1rem;
  border:none; border-radius:8px; padding:8px;
}
#musicToggle,#darkToggle {
  position:fixed; top:1rem; width:40px; height:40px;
  border:none; border-radius:50%; font-size:1.2rem;
}
#musicToggle {right:1rem; background:rgba(108,99,255,.6)}
#darkToggle {right:4.2rem; background:rgba(255,255,255,.4)}
</style>
</head>
<body>

<div id="intro">
  <h1>FaithMoods</h1>
  <small>Find clarity in Scripture</small>
  <button id="startBtn">Start</button>
</div>

<header>
  <h1>FaithMoods</h1>
  <small>Find clarity in Scripture</small>
</header>

<div class="container">
  <div class="panel">
    <h2>Emotions</h2>
    <ul id="emotions"></ul>
  </div>
  <div class="panel">
    <div id="reasons"></div>
    <div id="verseCard"></div>

    <div style="margin-top:1rem">
      <button id="prevVerseBtn">Prev</button>
      <button id="nextVerseBtn">Next</button>
      <button id="favBtn">‚ù§ Save</button>
      <button id="shareBtn">üì§ Share</button>
    </div>

    <textarea id="journal" placeholder="Your thoughts here..."></textarea>
  </div>
</div>

<button id="musicToggle">üîä</button>
<button id="darkToggle">üåô</button>

<audio id="bgMusic" loop src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_9abfc8e8c5.mp3?filename=ambient-piano-and-pad-112199.mp3"></audio>

<script type="module">
/* FIREBASE */
import { initializeApp } 
from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";

import { getFirestore, collection, doc, getDoc, getDocs }
from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCqwVQx8NbHucvpYmftMG3uSsTFQ5WBWM0",
  authDomain: "soultabs-c814d.firebaseapp.com",
  projectId: "soultabs-c814d",
  storageBucket: "soultabs-c814d.firebasestorage.app",
  messagingSenderId: "51287038225",
  appId: "1:51287038225:web:f8afac352a833f362214b0",
  measurementId: "G-B24FPHB1GC"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* INTRO */
document.getElementByIdstartBtn.addEventListener('click',() =>{
  document.getElementById('intro').style.display = "none"; // bypass fade
  startMusic();
  loadEmotions();
});

/* MUSIC */
const music = document.getElementById("bgMusic");
document.getElementById("musicToggle").onclick = () => {
  if(music.paused){music.play();} else {music.pause();}
};

/* DARK MODE */
document.getElementById("darkToggle").onclick = () => {
  document.body.classList.toggle("dark");
};

/* FIRESTORE */
let verses = [], index = 0;

async function loadEmotions(){
  const snap = await getDocs(collection(db,"emotions"));
  const list = document.getElementById("emotions");
  list.innerHTML = "";
  snap.forEach(d=>{
    const li = document.createElement("li");
    li.textContent = d.id;
    li.onclick = () => loadReasons(d.id);
    list.appendChild(li);
  });
}

async function loadReasons(em){
  const snap = await getDocs(collection(db,`emotions/${em}/reasons`));
  const div = document.getElementById("reasons");
  div.innerHTML = `<h2>${em.toUpperCase()}</h2>`;
  snap.forEach(r=>{
    const b = document.createElement("button");
    b.textContent = r.id.replace(/_/g," ");
    b.onclick = () => showVerse(em,r.id);
    div.appendChild(b);
  });
}

async function showVerse(em,reason){
  const ref = doc(db,`emotions/${em}/reasons/${reason}`);
  const data = (await getDoc(ref)).data();
  verses = Array.isArray(data.verses)
    ? data.verses
    : data.verses.split(/\n/).filter(v=>v.trim()!="");
  index = Math.floor(Math.random()*verses.length);
  displayVerse();
}

function displayVerse(){
  const card = document.getElementById("verseCard");
  card.textContent = verses[index];
  card.classList.add("visible");
}

document.getElementById("nextVerseBtn").onclick = ()=>{
  if(!verses.length) return;
  index = (index+1)%verses.length; displayVerse();
};

document.getElementById("prevVerseBtn").onclick = ()=>{
  if(!verses.length) return;
  index = (index-1+verses.length)%verses.length; displayVerse();
};

/* SAVE / SHARE / JOURNAL */
document.getElementById("favBtn").onclick = ()=>{
  if(!verses.length) return;
  const s = JSON.parse(localStorage.getItem("favorites")||"[]");
  s.push(verses[index]);
  localStorage.setItem("favorites",JSON.stringify(s));
  alert("Saved ‚ù§Ô∏è");
};

document.getElementById("shareBtn").onclick = ()=>{
  navigator.clipboard.writeText(verses[index]);
  alert("Copied to clipboard üìã");
};

const journal = document.getElementById("journal");
journal.value = localStorage.getItem("journal")||"";
journal.oninput = ()=>localStorage.setItem("journal",journal.value);

/* AUTO MUSIC */
function startMusic(){music.volume=.18; music.play().catch(()=>{});}
</script>
</body>
</html>
