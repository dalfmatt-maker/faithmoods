<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>FaithMoods</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />

<style>
body {
    font-family: Poppins, sans-serif;
    margin: 0;
    background: linear-gradient(120deg,#6C63FF,#8E2DE2,#4A00E0);
    color: white;
    text-align: center;
}

/* Containers */
.screen { display: none; padding: 20px; max-width: 550px; margin: auto; }

/* Emotion & Reason Buttons */
.btn-box {
    width: 100%; padding: 14px; margin: 6px 0;
    background: rgba(255,255,255,0.2);
    border-radius: 10px; cursor: pointer; font-size: 18px;
    transition: .2s;
}
.btn-box:hover { background: rgba(255,255,255,0.35); }

/* Verse Box */
#verseCard {
    background: rgba(255,255,255,0.25); padding: 14px; margin-top: 15px;
    border-radius: 10px; font-size: 17px; display: none;
}

/* Tabs */
.navbar {
    position: fixed; bottom: 0; left: 0; width: 100%;
    background: rgba(0,0,0,0.25); backdrop-filter: blur(12px);
    display: flex; justify-content: space-around; padding: 10px 0;
}
.nav-item { text-align: center; font-size: 14px; cursor: pointer; color: #fff; }
.nav-item.active { font-weight: bold; }

/* Buttons */
button {
    padding: 10px 14px; margin: 5px; border: none; border-radius: 8px;
    background: #7f57ff; color: white; cursor: pointer;
}
button:hover { opacity: .85; }

/* Text Area */
textarea {
    width: 100%; height: 120px; border-radius: 10px; padding: 10px;
    font-family: inherit; border: none; margin-top: 10px;
}

/* Dark Mode */
.dark {
  background: #111 !important;
  color: #eee !important;
}
.dark .btn-box { background: rgba(255,255,255,0.15) }
.dark .navbar { background: rgba(255,255,255,0.1) }
</style>
</head>
<body>

<!-- 🟣 START SCREEN -->
<div id="startScreen" class="screen" style="display:block;">
    <h1>FaithMoods</h1>
    <button id="guestBtn">Continue as Guest</button>
    <button id="loginBtn">Sign In with Google</button>
</div>

<!-- 🟣 HOME SCREEN -->
<div id="homeScreen" class="screen">
    <h2>How are you feeling?</h2>
    <div id="emotionList"></div>

    <div id="reasonSection" style="display:none;">
        <h3>Why do you feel this way?</h3>
        <div id="reasonList"></div>
        <div id="verseCard"></div>

        <textarea id="miniJournal" placeholder="Write your reflection..."></textarea>
        <button id="saveFavoriteBtn">❤️ Save</button>
    </div>
</div>

<!-- ⭐ FAVORITES -->
<div id="favoritesScreen" class="screen">
    <h2>Favorites</h2>
    <ul id="favoritesList" style="list-style:none; padding:0;"></ul>
</div>

<!-- 📓 JOURNAL -->
<div id="journalScreen" class="screen">
    <h2>Journal</h2>
    <textarea id="fullJournal" placeholder="Write your journal here..."></textarea><br>
    <button onclick="exportJournal()">Export Journal</button>
</div>

<!-- 👤 PROFILE -->
<div id="profileScreen" class="screen">
    <h2>Profile</h2>
    <div style="font-size:80px;">👤</div>
    <input id="usernameInput" placeholder="Enter username"/>
    <p id="streakText">Streak: 0🔥</p>
    <textarea id="weeklyVerse" placeholder="Your verse of the week..."></textarea>
</div>

<!-- ⚙️ SETTINGS -->
<div id="settingsScreen" class="screen">
    <h2>Settings</h2>
    <button onclick="toggleDarkMode()">🌙 Toggle Dark Mode</button><br><br>
    <button onclick="toggleClicks()">🔔 Toggle Click Sound</button>
</div>

<!-- 📱 Bottom Navigation -->
<div class="navbar">
    <div class="nav-item active" onclick="switchTab('homeScreen')">🏠<br>Home</div>
    <div class="nav-item" onclick="switchTab('favoritesScreen')">⭐<br>Favorites</div>
    <div class="nav-item" onclick="switchTab('journalScreen')">📓<br>Journal</div>
    <div class="nav-item" onclick="switchTab('profileScreen')">👤<br>Profile</div>
    <div class="nav-item" onclick="switchTab('settingsScreen')">⚙️<br>Settings</div>
</div>

<script type="module">
import { app } from "./firebase.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";

const db = getFirestore(app);
const auth = getAuth(app);

document.getElementById("guestBtn").onclick = () => showApp();
document.getElementById("loginBtn").onclick = async () => {
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
    showApp();
};

function showApp() {
    document.getElementById("startScreen").style.display = "none";
    switchTab("homeScreen");
    loadEmotions();
}

async function loadEmotions() {
    const list = document.getElementById("emotionList");
    list.innerHTML = "";

    const snap = await getDocs(collection(db, "emotions"));
    snap.forEach(docSnap => {
        const btn = document.createElement("div");
        btn.className = "btn-box";
        btn.textContent = docSnap.id;
        btn.onclick = () => loadReasons(docSnap.id);
        list.appendChild(btn);
    });
}

async function loadReasons(emotion) {
    document.getElementById("reasonSection").style.display = "block";
    const container = document.getElementById("reasonList");
    container.innerHTML = "";

    const snap = await getDocs(collection(db, `emotions/${emotion}/reasons`));
    snap.forEach(docSnap => {
        const btn = document.createElement("div");
        btn.className = "btn-box";
        btn.textContent = docSnap.id.replace(/_/g," ");
        btn.onclick = () => loadVerse(emotion, docSnap.id);
        container.appendChild(btn);
    });
}

async function loadVerse(emotion, reason) {
    const data = (await getDoc(doc(db, `emotions/${emotion}/reasons/${reason}`))).data();
    let verses = Array.isArray(data.verses)?data.verses:data.verses.split(/\r?\n/);
    const verse = verses[Math.floor(Math.random()*verses.length)];
    document.getElementById("verseCard").style.display="block";
    document.getElementById("verseCard").textContent = verse;
    currentVerse = verse;
}

let currentVerse="";
document.getElementById("saveFavoriteBtn").onclick = ()=>{
 let favs = JSON.parse(localStorage.getItem("favorites")||"[]");
 favs.push(currentVerse);
 localStorage.setItem("favorites",JSON.stringify(favs));
 loadFavorites();
};

function loadFavorites(){
 let favs = JSON.parse(localStorage.getItem("favorites")||"[]");
 let list = document.getElementById("favoritesList");
 list.innerHTML="";
 favs.forEach((v,i)=>{
  let li=document.createElement("li");
  li.innerHTML = `${v} <button onclick="removeFavorite(${i})">❌</button>`;
  list.appendChild(li);
 });
}
window.removeFavorite=(i)=>{
 let favs=JSON.parse(localStorage.getItem("favorites"));
 favs.splice(i,1);
 localStorage.setItem("favorites",JSON.stringify(favs));
 loadFavorites();
};

/* UI */
window.switchTab = (id)=>{
 document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
 document.getElementById(id).style.display="block";
 document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
 event.target.classList.add("active");
};

function toggleDarkMode(){ document.body.classList.toggle("dark"); }
function toggleClicks(){ clickSoundEnabled = !clickSoundEnabled; }

let clickSoundEnabled=true;
document.body.addEventListener("click",()=>{ if(clickSoundEnabled)new Audio("https://cdn.pixabay.com/download/audio/2021/09/21/audio_478d89c7d3.mp3").play(); });

function exportJournal(){ alert("📝 Export coming soon"); }
</script>

</body>
</html>
