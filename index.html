<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>FaithMoods</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
<style>
:root {
  --purple:#6C63FF;
  --glass:rgba(255,255,255,.2);
}
body {
  font-family:'Poppins',sans-serif;
  margin:0;
  background:linear-gradient(120deg,#6C63FF,#8E2DE2,#4A00E0);
  color:white;
  display:flex; flex-direction:column;
  height:100vh;
}

/* intro screen */
#intro {
  position:fixed; inset:0; display:flex;
  align-items:center; justify-content:center; flex-direction:column;
  background:inherit; z-index:9999;
}
.fadeOut { animation: fadeOut 1.5s forwards; }
@keyframes fadeOut { to { opacity:0; visibility:hidden; } }

/* bottom nav */
#nav {
  position:fixed; bottom:0; left:0; right:0;
  background:rgba(0,0,0,.3);
  backdrop-filter:blur(10px);
  display:flex; justify-content:space-around;
  padding:10px 0;
}
.nav-item {
  text-align:center; font-size:.8rem; cursor:pointer;
}

/* panels */
.container {
  padding:1rem; padding-bottom:80px;
}
.panel {
  background:var(--glass); padding:1rem;
  border-radius:1rem; margin-bottom:1rem;
  backdrop-filter:blur(10px);
}

/* verse card */
#verseCard {
  padding:1rem;
  border-left:4px solid var(--purple);
  min-height:70px;
  border-radius:.5rem;
  opacity:0; transition:opacity .5s;
  background:rgba(255,255,255,.15);
}
#verseCard.visible { opacity:1; }

button {
  background:var(--purple);
  border:none; padding:.5rem 1rem;
  border-radius:.5rem; color:white; cursor:pointer;
}

.dark {
  background:#111 !important; color:white;
}
</style>
</head>
<body>

<!-- intro -->
<div id="intro">
  <h1>FaithMoods</h1>
  <small>Find clarity in Scripture</small>
  <button id="startBtn">Start</button>
</div>

<!-- container -->
<header style="text-align:center;padding:1rem;">
  <h2 id="pageTitle">Emotions</h2>
</header>

<div class="container" id="mainView">
  <div class="panel">
    <ul id="emotions"></ul>
    <div id="reasons"></div>
    <div id="verseCard"></div>

    <div style="display:flex;gap:.5rem;margin-top:10px;">
      <button id="prevVerseBtn">Prev</button>
      <button id="nextVerseBtn">Next</button>
      <button id="favBtn">‚ù§ Save</button>
      <button id="shareBtn">Share</button>
    </div>
  </div>

  <textarea id="journal" placeholder="Write your reflection..."
    style="width:100%;height:120px;border-radius:.5rem;padding:.5rem;"></textarea>
</div>

<!-- favorites view -->
<div class="container" id="favoritesView" style="display:none;">
  <h3>Your Favorites</h3>
  <div id="favList"></div>
</div>

<!-- bottom nav -->
<div id="nav">
  <div class="nav-item" id="navHome">üè†<br>Home</div>
  <div class="nav-item" id="navFavs">‚ù§Ô∏è<br>Favorites</div>
  <div class="nav-item" id="navDark">üåô<br>Mode</div>
  <div class="nav-item" id="navMusic">üîä<br>Music</div>
</div>

<audio id="bgMusic" loop src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_9abfc8e8c5.mp3?filename=ambient-piano-and-pad-112199.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getFirestore, collection, doc, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyCqwVQx8NbHucvpYmftMG3uSsTFQ5WBWM0",
  authDomain:"soultabs-c814d.firebaseapp.com",
  projectId:"soultabs-c814d",
  storageBucket:"soultabs-c814d.firebasestorage.app",
  messagingSenderId:"51287038225",
  appId:"1:51287038225:web:f8afac352a833f362214b0",
  measurementId:"G-B24FPHB1GC"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const intro=document.getElementById("intro");
const startBtn=document.getElementById("startBtn");
const music = document.getElementById("bgMusic");
let audioUnlocked = false;

startBtn.onclick = async () => {
  intro.classList.add("fadeOut");
  if (!audioUnlocked) { try { await music.play(); audioUnlocked=true; } catch {} }
  loadEmotions();
};

// dark mode
document.getElementById("navDark").onclick=()=>document.body.classList.toggle("dark");

// music toggle
document.getElementById("navMusic").onclick=()=>{
  audioUnlocked=true;
  music.paused?music.play():music.pause();
};

// nav switching
document.getElementById("navHome").onclick=()=>{
  mainView.style.display="block";
  favoritesView.style.display="none";
  pageTitle.textContent="Emotions";
};
document.getElementById("navFavs").onclick=()=>{
  mainView.style.display="none";
  favoritesView.style.display="block";
  showFavorites();
  pageTitle.textContent="Favorites";
};

// firestore logic
let currentVerses=[],currentIndex=0;
async function loadEmotions(){
  const snap=await getDocs(collection(db,"emotions"));
  const list=document.getElementById("emotions"); list.innerHTML="";
  snap.forEach(docSnap=>{
    const li=document.createElement("li");
    li.textContent=docSnap.id;
    li.style="list-style:none;padding:.5rem;background:rgba(255,255,255,.2);margin:.3rem;border-radius:.5rem;cursor:pointer;";
    li.onclick=()=>loadReasons(docSnap.id);
    list.appendChild(li);
  });
}
async function loadReasons(emotion){
  const snap=await getDocs(collection(db,`emotions/${emotion}/reasons`));
  const div=document.getElementById("reasons");
  div.innerHTML=`<h3>${emotion.toUpperCase()}</h3>`;
  snap.forEach(docSnap=>{
    const b=document.createElement("button");
    b.textContent=docSnap.id.replace(/_/g," ");
    b.onclick=()=>showVerse(emotion,docSnap.id);
    div.appendChild(b);
  });
  verseCard.textContent="";
}
async function showVerse(emotion,reason){
  const docRef = await getDoc(doc(db,`emotions/${emotion}/reasons/${reason}`));
  let verses = docRef.data().verses;
  if(Array.isArray(verses)) currentVerses=verses;
  else currentVerses = verses.split(/\r?\n/).filter(v=>v.trim()!=="");
  currentIndex=Math.floor(Math.random()*currentVerses.length);
  displayVerse();
}
function displayVerse(){
  const c=document.getElementById("verseCard");
  if(!currentVerses.length){c.textContent="No verse";return;}
  c.classList.remove("visible");
  setTimeout(()=>{
    c.textContent=currentVerses[currentIndex];
    c.classList.add("visible");
  },150);
}
prevVerseBtn.onclick=()=>{if(currentVerses.length){currentIndex=(currentIndex-1+currentVerses.length)%currentVerses.length;displayVerse();}};
nextVerseBtn.onclick=()=>{if(currentVerses.length){currentIndex=(currentIndex+1)%currentVerses.length;displayVerse();}};

// favorites
favBtn.onclick=()=>{
  const favs=JSON.parse(localStorage.getItem("favorites")||"[]");
  favs.push(currentVerses[currentIndex]);
  localStorage.setItem("favorites",JSON.stringify(favs));
  alert("Saved!");
};
function showFavorites(){
  const favs=JSON.parse(localStorage.getItem("favorites")||"[]");
  favList.innerHTML="";
  favs.forEach(v=>{
    const div=document.createElement("div");
    div.textContent=v;
    div.style="padding:.5rem;background:rgba(255,255,255,.2);margin:.3rem;border-radius:.5rem;";
    favList.appendChild(div);
  });
}

// share
shareBtn.onclick=()=>{
  navigator.clipboard.writeText(currentVerses[currentIndex]);
  alert("Copied!");
};

// journal
const journal=document.getElementById("journal");
journal.value=localStorage.getItem("journal")||"";
journal.oninput=()=>localStorage.setItem("journal",journal.value);
</script>
</body>
</html>
