<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FaithMoods</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root{
 --bg1:#6C63FF;
 --bg2:#4A00E0;
 --glass:rgba(255,255,255,0.18);
 --round:14px;
 --blur:10px;
}
body{
 margin:0; font-family:"Poppins",sans-serif;
 background:linear-gradient(120deg,#6C63FF,#8E2DE2,#4A00E0);
 background-size:400% 400%;
 animation:bgShift 12s ease infinite;
 color:white; min-height:100vh;
 display:flex; flex-direction:column;
}
@keyframes bgShift{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}

header{text-align:center;padding:1rem;font-size:26px;font-weight:600;}

.container{padding:1rem;}

.panel{
 background:var(--glass); backdrop-filter:blur(var(--blur));
 border-radius:var(--round); padding:1rem; margin-bottom:1rem;
}

button{
 cursor:pointer;border:none;border-radius:10px;
 padding:.6rem 1rem;background:#6C63FF;color:white;font-weight:600;
}
button:hover{opacity:.85;}

ul{list-style:none;padding:0}
li{
 background:rgba(255,255,255,0.15);
 margin:.3rem 0;padding:.6rem;border-radius:8px;
 cursor:pointer;
}

#verseBox{
 background:rgba(255,255,255,0.1);
 border-left:4px solid #fff;padding:1rem;
 border-radius:8px;min-height:60px;margin-top:1rem;font-style:italic;
}

.navbar{
 position:fixed;bottom:0;left:0;right:0;
 background:rgba(0,0,0,0.28);backdrop-filter:blur(12px);
 display:flex;justify-content:space-around;padding:.6rem 0;
}
.nav-btn{
 background:none;border:none;color:white;
 display:flex;flex-direction:column;font-size:13px;
}
.nav-btn:hover{opacity:.8;}

textarea{
 width:100%;padding:.8rem;border-radius:var(--round);
 border:none;margin-top:1rem;height:110px;
 font-family:Poppins;
}

.hidden{display:none;}
.dark-mode{
 background:black !important;color:white !important;
}
</style>
</head>

<body>

<header>FaithMoods</header>

<div class="container">

<div id="authSection" class="panel">
 <button id="googleLogin">Sign in with Google</button>
</div>

<div id="appSection" class="hidden">

<div class="panel">
 <h2>Emotions</h2>
 <ul id="emotions"></ul>
</div>

<div class="panel">
 <div id="reasons"></div>
 <div id="verseBox"></div>
 <br>
 <button id="prev">Prev</button>
 <button id="next">Next</button>
 <button id="saveFav">‚ù§Ô∏è Save</button>
 <button id="shareBtn">üì§ Share</button>
 <textarea id="journal" placeholder="Write your reflection..."></textarea>
</div>

</div>

<div id="favoritesSection" class="panel hidden">
 <h2>Favorites</h2>
 <ul id="favList"></ul>
</div>

<div id="modeSection" class="panel hidden">
 <h2>Dark Mode</h2>
 <button id="toggleMode">Toggle Theme</button>
</div>

<div id="musicSection" class="panel hidden">
 <h2>Music</h2>
 <button id="toggleMusic">Play / Pause</button>
</div>

</div>

<!-- NAV BAR -->
<div class="navbar">
 <button class="nav-btn" id="navHome">üè†<span>Home</span></button>
 <button class="nav-btn" id="navFav">‚≠ê<span>Favorites</span></button>
 <button class="nav-btn" id="navMode">üåô<span>Mode</span></button>
 <button class="nav-btn" id="navMusic">üéµ<span>Music</span></button>
</div>

<!-- BACKGROUND MUSIC -->
<audio id="bgMusic" loop>
 <source src="https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Scott_Holmes_Music/Happy_Music/Scott_Holmes_Music_-_Happy_Adventure.mp3" type="audio/mpeg">
</audio>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, collection, doc, getDocs, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

const firebaseConfig = {
 apiKey:"AIzaSyCqwVQx8NbHucvpYmftMG3uSsTFQ5WBWM0",
 authDomain:"soultabs-c814d.firebaseapp.com",
 projectId:"soultabs-c814d",
 storageBucket:"soultabs-c814d.firebasestorage.app",
 messagingSenderId:"51287038225",
 appId:"1:51287038225:web:f8afac352a833f362214b0",
 measurementId:"G-B24FPHB1GC"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);
const provider=new GoogleAuthProvider();

let verses=[],index=0;

function showSection(home,fav,mode,music){
 document.getElementById("appSection").classList.toggle("hidden",!home);
 document.getElementById("favoritesSection").classList.toggle("hidden",!fav);
 document.getElementById("modeSection").classList.toggle("hidden",!mode);
 document.getElementById("musicSection").classList.toggle("hidden",!music);
}

// Nav
navHome.onclick=()=>showSection(true,false,false,false);
navFav.onclick=()=>showSection(false,true,false,false);
navMode.onclick=()=>showSection(false,false,true,false);
navMusic.onclick=()=>showSection(false,false,false,true);

// Auth
googleLogin.onclick=async()=>{
 await signInWithPopup(auth,provider);
 authSection.classList.add("hidden");
 appSection.classList.remove("hidden");
 loadEmotions();
};

// Load emotions
async function loadEmotions(){
 const snap=await getDocs(collection(db,"emotions"));
 emotions.innerHTML="";
 snap.forEach(d=>{
  let li=document.createElement("li");
  li.textContent=d.id;
  li.onclick=()=>loadReasons(d.id);
  emotions.appendChild(li);
 });
}

// Load reasons
async function loadReasons(emotion){
 const snap=await getDocs(collection(db,`emotions/${emotion}/reasons`));
 reasons.innerHTML="";
 snap.forEach(r=>{
  let b=document.createElement("button");
  b.textContent=r.id.replace(/_/g," ");
  b.onclick=()=>loadVerses(emotion,r.id);
  reasons.appendChild(b);
 });
}

// Load verses
async function loadVerses(emotion,reason){
 let docSnap=await getDoc(doc(db,`emotions/${emotion}/reasons/${reason}`));
 verses=docSnap.data().verses;
 index=0;
 display();
}

function display(){
 if(!verses||!verses.length){verseBox.textContent="No verses"; return;}
 verseBox.textContent=verses[index];
}

prev.onclick=()=>{index=(index-1+verses.length)%verses.length;display();}
next.onclick=()=>{index=(index+1)%verses.length;display();}

saveFav.onclick=()=>{
 let arr=JSON.parse(localStorage.getItem("faves")||"[]");
 arr.push(verses[index]);
 localStorage.setItem("faves",JSON.stringify(arr));
 alert("Saved!");
 loadFaves();
};

// show favorites
function loadFaves(){
 let arr=JSON.parse(localStorage.getItem("faves")||"[]");
 favList.innerHTML="";
 arr.forEach(v=>{
  let li=document.createElement("li");
  li.textContent=v;
  favList.appendChild(li);
 });
}
loadFaves();

// Share
shareBtn.onclick=()=>{
 navigator.clipboard.writeText(verses[index]);
 alert("Copied!");
};

// Journal
journal.value=localStorage.getItem("journal")||"";
journal.oninput=()=>localStorage.setItem("journal",journal.value);

// Dark mode
toggleMode.onclick=()=>document.body.classList.toggle("dark-mode");

// Music
const bgMusic=document.getElementById("bgMusic");
toggleMusic.onclick=()=>{bgMusic.paused?bgMusic.play():bgMusic.pause();}
navMusic.onclick=()=>{bgMusic.paused?bgMusic.play():bgMusic.pause();}
</script>

</body>
</html>
