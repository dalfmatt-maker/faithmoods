<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>FaithMoods</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />

<style>
:root {
  --purple:#6C63FF;
  --glass:rgba(255,255,255,0.25);
  --bg-light:linear-gradient(120deg,#6C63FF,#8E2DE2,#4A00E0);
  --bg-dark: #0d0d15;
}
*{box-sizing:border-box;}
body {
  margin:0;font-family:Poppins,sans-serif;
  background:var(--bg-light); background-size:300% 300%;
  animation:bgShift 10s infinite; color:#fff; overflow-x:hidden;
}
@keyframes bgShift {0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}

.hidden{display:none;}
.fadeOut{animation:fadeOut 1.2s forwards;}
@keyframes fadeOut{to{opacity:0;visibility:hidden}}

#intro {
  position:fixed; inset:0; display:flex;flex-direction:column;justify-content:center;align-items:center;
  background:inherit; z-index:10; text-align:center;
}
button {
  background:var(--purple); color:#fff; border:none; padding:.6rem 1rem;
  border-radius:8px; cursor:pointer; font-size:1rem;
}
button:hover{opacity:.85;}

.container {
  padding:1rem; margin-top:100px;
}
.panel {
  background:var(--glass);backdrop-filter:blur(12px);
  padding:1rem;border-radius:1rem;margin-bottom:80px;
}

#emotions li {
  background:rgba(255,255,255,0.2);
  padding:.7rem; margin:.4rem 0;
  border-radius:8px; cursor:pointer;
}
#emotions li:hover { background:rgba(255,255,255,0.4); }

#verseCard{
  background:rgba(0,0,0,0.3);padding:1rem;border-radius:8px;
  margin-top:1rem;min-height:60px;opacity:0;transition:.4s;
}
#verseCard.visible{opacity:1;}

textarea {
  width:100%;border-radius:8px;border:none;padding:.6rem;margin-top:1rem;font-family:Poppins;
}

/* Bottom Nav */
#nav {
  position:fixed;bottom:0;left:0;right:0;height:65px;
  background:rgba(0,0,0,0.35);backdrop-filter:blur(15px);
  display:flex;justify-content:space-around;align-items:center;
}
.nav-btn {
  color:white;text-align:center;font-size:.8rem;cursor:pointer;
}

/* Dark Mode */
.dark body {background:var(--bg-dark);}
.dark #nav{background:rgba(255,255,255,0.1);}
</style>
</head>
<body>

<!-- Intro -->
<div id="intro">
  <h1 style="font-size:2.4rem">FaithMoods</h1>
  <p>Find clarity in Scripture</p>
  <button id="startBtn">Start</button>
</div>

<!-- Tabs -->
<div id="homeView" class="container">
  <div class="panel">
    <h2>Emotions</h2>
    <ul id="emotions"></ul>
  </div>

  <div class="panel">
    <div id="reasons"></div>
    <div id="verseCard"></div>

    <div style="display:flex;gap:.4rem;margin-top:.5rem;">
      <button id="prevVerseBtn">Prev</button>
      <button id="nextVerseBtn">Next</button>
      <button id="favBtn">‚ù§</button>
      <button id="shareBtn">üì§</button>
    </div>

    <textarea id="journal" placeholder="Write your reflection..."></textarea>
  </div>
</div>

<div id="favoritesView" class="container hidden">
  <h2>Your Favorites</h2>
  <div id="favList"></div>
</div>

<div id="journalView" class="container hidden">
  <h2>Journal</h2>
  <textarea id="journalPage" style="height:300px;"></textarea>
</div>

<div id="profileView" class="container hidden">
  <h2>Profile</h2>
  <button id="googleBtn" style="width:100%;margin-top:1rem;">Sign in with Google</button>
  <button id="darkToggle" style="margin-top:1rem;width:100%;">Toggle Dark Mode üåô</button>
</div>

<!-- Bottom Nav -->
<div id="nav">
  <div class="nav-btn" data-tab="homeView">üè†<br>Home</div>
  <div class="nav-btn" data-tab="favoritesView">‚≠ê<br>Favorites</div>
  <div class="nav-btn" data-tab="journalView">üìù<br>Journal</div>
  <div class="nav-btn" data-tab="profileView">üë§<br>Profile</div>
</div>

<audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_9abfc8e8c5.mp3?filename=ambient-piano-and-pad-112199.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, doc, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const app = initializeApp({
  apiKey:"AIzaSyCqwVQx8NbHucvpYmftMG3uSsTFQ5WBWM0",
  authDomain:"soultabs-c814d.firebaseapp.com",
  projectId:"soultabs-c814d"
});
const db = getFirestore(app);
const auth = getAuth();
const provider = new GoogleAuthProvider();

/* UI */
const intro=document.getElementById("intro");
const startBtn=document.getElementById("startBtn");
const darkToggle=document.getElementById("darkToggle");
const music=document.getElementById("bgMusic");
const emotionsList=document.getElementById("emotions");
const verseCard=document.getElementById("verseCard");
const journal=document.getElementById("journal");
const journalPage=document.getElementById("journalPage");

let currentVerses=[],idx=0;

/* Start */
startBtn.onclick=()=>{
 intro.classList.add("fadeOut");
 music.play().catch(()=>{}); // Plays only after user click
 loadEmotions();
};

/* Tabs */
document.querySelectorAll(".nav-btn").forEach(btn=>{
 btn.onclick=()=>{
   document.querySelectorAll(".container").forEach(v=>v.classList.add("hidden"));
   document.getElementById(btn.dataset.tab).classList.remove("hidden");
   if(btn.dataset.tab==="favoritesView") loadFavorites();
 };
});

/* Dark Mode */
if(localStorage.getItem("dark")==="true") document.body.classList.add("dark");
darkToggle.onclick=()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
};

/* Google Login */
document.getElementById("googleBtn").onclick=async()=>{
  try { await signInWithPopup(auth,provider); alert("Signed in ‚úÖ"); }
  catch { alert("Add domain to Firebase Auth"); }
};

/* Firestore */
async function loadEmotions(){
 const snap=await getDocs(collection(db,"emotions"));
 emotionsList.innerHTML="";
 snap.forEach(d=>{
  let li=document.createElement("li");
  li.textContent=d.id; li.onclick=()=>loadReasons(d.id);
  emotionsList.appendChild(li);
 });
}
async function loadReasons(e){
 const snap=await getDocs(collection(db,`emotions/${e}/reasons`));
 let div=document.getElementById("reasons");
 div.innerHTML=`<h3>${e.toUpperCase()}</h3>`;
 snap.forEach(r=>{
  let b=document.createElement("button");
  b.textContent=r.id.replace(/_/g," ");
  b.onclick=()=>loadVerse(e,r.id);
  div.appendChild(b);
 });
 verseCard.textContent="";
}
async function loadVerse(e,r){
 const s=await getDoc(doc(db,`emotions/${e}/reasons/${r}`));
 let v=s.data().verses;
 currentVerses=Array.isArray(v)?v:v.split("\n");
 idx=Math.floor(Math.random()*currentVerses.length);
 showVerse();
}
function showVerse(){
 verseCard.classList.remove("visible");
 setTimeout(()=>{verseCard.textContent=currentVerses[idx];verseCard.classList.add("visible");},120);
}
document.getElementById("nextVerseBtn").onclick=()=>{idx=(idx+1)%currentVerses.length;showVerse();}
document.getElementById("prevVerseBtn").onclick=()=>{idx=(idx-1+currentVerses.length)%currentVerses.length;showVerse();}

/* Favorites & Journal */
document.getElementById("favBtn").onclick=()=>{
 let f=JSON.parse(localStorage.getItem("favorites")||"[]");
 f.push(currentVerses[idx]); localStorage.setItem("favorites",JSON.stringify(f));
 alert("‚≠ê Saved");
};
function loadFavorites(){
 let f=JSON.parse(localStorage.getItem("favorites")||"[]");
 let box=document.getElementById("favList");
 box.innerHTML="";
 f.forEach(v=>{
  let d=document.createElement("div");
  d.style.margin="8px 0"; d.innerHTML=`${v} <button onclick="navigator.clipboard.writeText('${v}')">Copy</button>`;
  box.appendChild(d);
 });
}
document.getElementById("shareBtn").onclick=()=>navigator.clipboard.writeText(currentVerses[idx]);
journal.value=localStorage.getItem("journal")||""; journal.oninput=()=>localStorage.setItem("journal",journal.value);
journalPage.value=journal.value; journalPage.oninput=()=>{journal.value=journalPage.value;localStorage.setItem("journal",journalPage.value);}
</script>
</body>
</html>

