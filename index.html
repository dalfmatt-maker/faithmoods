<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FaithMoods</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body {
  margin: 0; font-family: 'Poppins', sans-serif;
  background: linear-gradient(120deg, #6C63FF, #8E2DE2, #4A00E0);
  color: white; text-align: center;
  padding-bottom: 80px;
}

.screen { display: none; padding: 20px; }
button {
  background: #6C63FF; border: none; padding: 10px 16px;
  color: white; border-radius: 8px; margin: 6px; cursor: pointer;
}
button:hover { opacity: .9; }

.card {
  background: rgba(255,255,255,0.15);
  padding: 15px; border-radius: 10px; margin: 10px auto;
  max-width: 700px;
}

.emotion-btn, .reason-btn {
  display: block; width: 100%;
  margin: 6px 0; background: rgba(255,255,255,0.25);
}

.navbar {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: rgba(0,0,0,0.3); display: flex; justify-content: space-around;
  padding: 10px 0; backdrop-filter: blur(10px);
}
.nav-item { text-align: center; font-size: 12px; cursor: pointer; color: white; }

/* Dark mode */
.dark { background: #111 !important; color: #eee !important; }
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="screen" style="display:block;">
  <h1>FaithMoods</h1>
  <p>Welcome! How would you like to continue?</p>
  <button id="guestBtn">Continue as Guest</button>
  <br>
  <button id="googleBtn">Sign In with Google</button>
</div>

<!-- APP SCREEN -->
<div id="appScreen" class="screen">

<!-- HOME -->
<div id="homePage" class="screen" style="display:block;">
  <h2>How are you feeling?</h2>
  <div class="card">
    <div id="emotionList"></div>
  </div>
  <div class="card">
    <div id="reasonList"></div>
    <p id="verseBox"></p>
    <button id="prevBtn">Prev</button>
    <button id="nextBtn">Next</button>
    <button id="saveFavBtn">‚ù§Ô∏è Save</button>
  </div>
  <textarea id="miniJournal" placeholder="Write your reflection..." style="width:100%;height:120px;"></textarea>
</div>

<!-- FAVORITES -->
<div id="favoritesPage" class="screen">
  <h2>Favorites</h2>
  <div id="favList"></div>
</div>

<!-- JOURNAL -->
<div id="journalPage" class="screen">
  <h2>Journal</h2>
  <textarea id="bigJournal" style="width:100%;height:300px;"></textarea>
</div>

<!-- PROFILE -->
<div id="profilePage" class="screen">
  <h2>Profile</h2>
  <input id="usernameInput" placeholder="Enter username"><br><br>
  <input id="weekVerse" placeholder="Verse of the week"><br><br>
  <button id="saveProfile">Save Profile</button>
  <div id="profileInfo"></div>
</div>

<!-- SETTINGS -->
<div id="settingsPage" class="screen">
  <h2>Settings</h2>
  <button id="toggleDark">üåô Toggle Dark Mode</button><br>
  <button id="toggleClickSound">üîî Toggle Click Sound</button><br><br>
  <button id="logoutBtn">üö™ Sign Out</button>
</div>

</div>

<!-- NAV BAR -->
<div class="navbar">
  <div class="nav-item" onclick="showTab('homePage')">üè†<br>Home</div>
  <div class="nav-item" onclick="showTab('favoritesPage')">‚≠ê<br>Favorites</div>
  <div class="nav-item" onclick="showTab('journalPage')">üìì<br>Journal</div>
  <div class="nav-item" onclick="showTab('profilePage')">üë§<br>Profile</div>
  <div class="nav-item" onclick="showTab('settingsPage')">‚öôÔ∏è<br>Settings</div>
</div>

<!-- Firebase -->
<script type="module" src="firebase.js"></script>

<script type="module">
import { auth, db, googleProvider } from "./firebase.js";
import { signInWithPopup, signOut, onAuthStateChanged, browserLocalPersistence, setPersistence } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
import { collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

setPersistence(auth, browserLocalPersistence);

// Elements
const loginScreen = document.getElementById("loginScreen");
const appScreen = document.getElementById("appScreen");

// Login Buttons
document.getElementById("guestBtn").onclick = () => showApp();
document.getElementById("googleBtn").onclick = async () => { await signInWithPopup(auth, googleProvider); };

// Logout
document.getElementById("logoutBtn").onclick = async () => { await signOut(auth); location.reload(); };

// Auth State
onAuthStateChanged(auth, user => { user ? showApp() : showLogin(); });

function showApp(){ loginScreen.style.display="none"; appScreen.style.display="block"; }
function showLogin(){ loginScreen.style.display="block"; appScreen.style.display="none"; }

// Navigation
function showTab(id){
  document.querySelectorAll(".screen").forEach(e => e.style.display="none");
  document.getElementById(id).style.display="block";
  document.getElementById("appScreen").style.display="block";
}
window.showTab = showTab;

// Load emotions
const emotionList = document.getElementById("emotionList");
const reasonList = document.getElementById("reasonList");
const verseBox = document.getElementById("verseBox");
let verses = [], idx = 0;

async function loadEmotions(){
  const snap = await getDocs(collection(db, "emotions"));
  emotionList.innerHTML = "";
  snap.forEach(docSnap => {
    let b = document.createElement("button");
    b.className = "emotion-btn";
    b.textContent = docSnap.id;
    b.onclick = () => loadReasons(docSnap.id);
    emotionList.appendChild(b);
  });
}
loadEmotions();

async function loadReasons(emotion){
  reasonList.innerHTML = "<h3>Why are you feeling this way?</h3>";
  const path = `emotions/${emotion}/reasons`;
  const snap = await getDocs(collection(db, path));
  snap.forEach(docSnap => {
    let r = document.createElement("button");
    r.className="reason-btn";
    r.textContent = docSnap.id.replace(/_/g," ");
    r.onclick = () => showVerse(emotion, docSnap.id);
    reasonList.appendChild(r);
  });
}

async function showVerse(emotion, reason){
  const ref = doc(db, `emotions/${emotion}/reasons/${reason}`);
  const data = (await getDoc(ref)).data();
  verses = Array.isArray(data.verses) ? data.verses : data.verses.split("\n");
  idx = 0; verseBox.textContent = verses[idx];
}

// Buttons
document.getElementById("nextBtn").onclick = ()=>{ idx=(idx+1)%verses.length; verseBox.textContent=verses[idx]; }
document.getElementById("prevBtn").onclick = ()=>{ idx=(idx-1+verses.length)%verses.length; verseBox.textContent=verses[idx]; }

// Favorites
const favList = document.getElementById("favList");
document.getElementById("saveFavBtn").onclick = ()=>{
  if(!verses[idx]) return;
  let favs = JSON.parse(localStorage.getItem("favs") || "[]");
  favs.push(verses[idx]);
  localStorage.setItem("favs", JSON.stringify(favs));
  loadFavs();
};

function loadFavs(){
  favList.innerHTML = "";
  let favs = JSON.parse(localStorage.getItem("favs")||"[]");
  favs.forEach((v,i)=>{
    let div=document.createElement("div");
    div.innerHTML = `${v} <button onclick="delFav(${i})">‚ùå</button>`;
    favList.appendChild(div);
  });
}
window.delFav = (i)=>{
  let favs = JSON.parse(localStorage.getItem("favs")||"[]");
  favs.splice(i,1);
  localStorage.setItem("favs",JSON.stringify(favs));
  loadFavs();
};
loadFavs();

// Journals
document.getElementById("miniJournal").oninput = e=>{
  localStorage.setItem("miniNote", e.target.value);
};
document.getElementById("journalPage").onshow = ()=>{ bigJournal.value = localStorage.getItem("bigNote")||""; };
document.getElementById("bigJournal").oninput = e=>{
  localStorage.setItem("bigNote", e.target.value);
};

// Profile
document.getElementById("saveProfile").onclick = ()=>{
  localStorage.setItem("username", document.getElementById("usernameInput").value);
  localStorage.setItem("weekVerse", document.getElementById("weekVerse").value);
  document.getElementById("profileInfo").innerHTML = 
    `<p>User: ${localStorage.getItem("username")}</p><p>Verse of Week: ${localStorage.getItem("weekVerse")}</p>`;
};

// Settings
document.getElementById("toggleDark").onclick = ()=> document.body.classList.toggle("dark");
document.getElementById("toggleClickSound").onclick = ()=> alert("Click sounds coming soon!");

</script>

</body>
</html>
