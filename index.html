<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FaithMoods</title>
<link rel="icon" href="data:," />

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body {
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(120deg,#6C63FF,#8E2DE2,#4A00E0);
  background-size:400% 400%;
  animation:bgShift 12s ease infinite;
  color:white;
}

@keyframes bgShift {0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}

.container {padding:20px;max-width:900px;margin:auto;}
.panel {
  background:rgba(255,255,255,0.15);
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
  backdrop-filter:blur(8px);
}

button {border:none;padding:8px 14px;border-radius:6px;cursor:pointer;background:#6C63FF;color:white;}
button:hover {opacity:.8;}
ul {padding:0;list-style:none;}
ul li {
  background:rgba(255,255,255,.18);
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  cursor:pointer;
}
ul li:hover {background:rgba(255,255,255,.35);}

#verse {font-size:1.1rem;min-height:50px;margin-bottom:10px;}

textarea {
  width:100%;
  min-height:120px;
  border-radius:10px;
  border:none;
  padding:12px;
  font-family:'Poppins',sans-serif;
}

#nav {
  position:fixed;bottom:0;left:0;right:0;
  background:rgba(0,0,0,0.35);
  backdrop-filter:blur(8px);
  display:flex;justify-content:space-around;
  padding:10px 0;color:white;font-size:.9rem;
}
.nav-item {text-align:center;cursor:pointer;}
.nav-item.active {font-weight:600;color:#FFD86B;}

.hidden {display:none;}

#intro {
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:linear-gradient(120deg,#6C63FF,#8E2DE2,#4A00E0);
  display:flex;flex-direction:column;justify-content:center;align-items:center;
  color:white;z-index:10;
}
.fadeOut {animation:fadeOut 1s forwards;}
@keyframes fadeOut {to{opacity:0;visibility:hidden;}}

.dark body {background:#121212;color:white;}
</style>
</head>

<body>

<div id="intro">
  <h1>FaithMoods</h1>
  <p>Find clarity in Scripture</p>
  <button id="startBtn">Start</button>
  <button id="googleLogin">Sign in with Google</button>
</div>

<div class="container" id="homeTab">
  <h2>Emotions</h2>
  <ul id="emotions"></ul>

  <div class="panel">
    <div id="verse"></div>
    <button id="prevVerse">Prev</button>
    <button id="nextVerse">Next</button>
    <button id="saveFav">‚ù§Ô∏è Save</button>
    <button id="shareVerse">üì§ Share</button>
  </div>

  <textarea id="journal" placeholder="Write your reflection..."></textarea>
</div>

<div class="container hidden" id="favoritesTab">
  <h2>Favorites</h2>
  <div id="favList"></div>
</div>

<div class="container hidden" id="modeTab">
  <h2>Theme</h2>
  <button id="toggleTheme">Toggle Dark/Light</button>
</div>

<div class="container hidden" id="musicTab">
  <h2>Ambient Music</h2>
  <button id="musicToggle">Play / Pause</button>
</div>

<div id="nav">
  <div class="nav-item active" data-tab="homeTab">üè†<br>Home</div>
  <div class="nav-item" data-tab="favoritesTab">‚≠ê<br>Favorites</div>
  <div class="nav-item" data-tab="modeTab">üåô<br>Mode</div>
  <div class="nav-item" data-tab="musicTab">üéµ<br>Music</div>
</div>

<audio id="bgMusic" loop preload="auto"
src="https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Monplaisir/Monplaisir_Places/Monplaisir_-_Pleasant_Places.mp3">
</audio>

<script type="module">
/* ----- FIREBASE ----- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCqwVQx8NbHucvpYmftMG3uSsTFQ5WBWM0",
  authDomain: "soultabs-c814d.firebaseapp.com",
  projectId: "soultabs-c814d",
  storageBucket: "soultabs-c814d.firebasestorage.app",
  messagingSenderId: "51287038225",
  appId: "1:51287038225:web:f8afac352a833f362214b0",
  measurementId: "G-B24FPHB1GC"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);

/* ----- AUTH ----- */
document.getElementById("googleLogin").onclick = async () => {
  try { await signInWithPopup(auth, provider); alert("Signed in!"); }
  catch(e){ alert("Login error"); }
};

/* ----- UI / NAV ----- */
document.querySelectorAll(".nav-item").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".container").forEach(t=>t.classList.add("hidden"));
    document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
    document.getElementById(btn.dataset.tab).classList.remove("hidden");
    btn.classList.add("active");
  };
});

/* ----- INTRO ----- */
document.getElementById("startBtn").onclick = ()=>{
  document.getElementById("intro").classList.add("fadeOut");
  loadEmotions();
};

/* ----- JOURNAL ----- */
const journal = document.getElementById("journal");
journal.value = localStorage.getItem("journal") || "";
journal.oninput = ()=>localStorage.setItem("journal", journal.value);

/* ----- THEMES ----- */
document.getElementById("toggleTheme").onclick = ()=>document.body.classList.toggle("dark");

/* ----- MUSIC ----- */
const music = document.getElementById("bgMusic");
document.getElementById("musicToggle").onclick = ()=>{
  if(music.paused) music.play();
  else music.pause();
};

/* ----- FIRESTORE: EMOTIONS & VERSES ----- */
let verses = [], index = 0;

async function loadEmotions(){
  const snap = await getDocs(collection(db,"emotions"));
  const list = document.getElementById("emotions");
  list.innerHTML="";
  snap.forEach(docSnap=>{
    let li=document.createElement("li");
    li.textContent = docSnap.id;
    li.onclick = ()=>loadVerses(docSnap.id);
    list.appendChild(li);
  });
}

async function loadVerses(emotion){
  const rSnap = await getDocs(collection(db, `emotions/${emotion}/reasons`));
  for (let docSnap of rSnap.docs){
    let data = (await getDoc(doc(db,`emotions/${emotion}/reasons/${docSnap.id}`))).data();
    verses = data.verses || [];
  }
  index=0; showVerse();
}

function showVerse(){
  document.getElementById("verse").textContent = verses[index] || "No verses found";
}

document.getElementById("nextVerse").onclick = ()=>{if(verses.length){index=(index+1)%verses.length;showVerse();}};
document.getElementById("prevVerse").onclick = ()=>{if(verses.length){index=(index-1+verses.length)%verses.length;showVerse();}};

/* ----- FAVORITES ----- */
document.getElementById("saveFav").onclick = ()=>{
  let favs = JSON.parse(localStorage.getItem("favs")||"[]");
  if(verses[index]) favs.push(verses[index]);
  localStorage.setItem("favs",JSON.stringify(favs));
  loadFavorites();
};

function loadFavorites(){
  let favs = JSON.parse(localStorage.getItem("favs")||"[]");
  const box = document.getElementById("favList");
  box.innerHTML="";
  favs.forEach((v,i)=>{
    let div=document.createElement("div");
    div.textContent=v;
    let rm=document.createElement("button");
    rm.textContent="‚ùå";
    rm.onclick=()=>{
      favs.splice(i,1);
      localStorage.setItem("favs",JSON.stringify(favs));
      loadFavorites();
    };
    div.appendChild(rm);
    box.appendChild(div);
  });
}
document.getElementById("favoritesTab").onshow = loadFavorites;

document.getElementById("shareVerse").onclick = ()=>navigator.clipboard.writeText(verses[index]||"");

</script>

</body>
</html>
